/* ================= 全局設定 ================= */
body { margin: 0; padding: 0; background-color: #000; width: 100vw; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; font-family: 'Microsoft JhengHei', 'Arial', sans-serif; touch-action: none; }
#game-scale-wrapper { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }

/* 遊戲畫布：固定 1386x640 */
#game-container { width: 1386px; height: 640px; position: relative; flex-shrink: 0; background-color: #222; box-shadow: 0 0 50px rgba(0,0,0,0.8); }

.full-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: 100% 100%; z-index: 0; }
.screen { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 10; }
.screen.active { display: block; }
.hover-effect { cursor: pointer; border: none; background: none; padding: 0; transition: transform 0.1s; }
.hover-effect:active { transform: scale(0.95); }
.img-btn img, .icon-btn img, .control-btn img, .popup-btn img { display: block; width: 100%; height: auto; }

/* ★ [修正] 全域按鈕 (絕對定位在框內) ★ */
.lobby-icons {
    position: absolute; 
    top: 25px; right: 25px;
    display: flex; flex-direction: column; gap: 15px;
    z-index: 10000; pointer-events: auto;
}
.icon-btn { width: 75px; }

/* 左上角返回 */
.top-left-back { position: absolute; top: 25px; left: 25px; width: 80px; z-index: 10001; pointer-events: auto; }
.top-left-back img { width: 100%; }

/* 1. 大廳 */
.lobby-logo { position: absolute; top: 45px; left: 0; right: 0; margin: 0 auto; width: 594px; z-index: 2; animation: float 0.9s infinite ease-in-out; }
.lobby-buttons { position: absolute; bottom: 120px; left: 0; right: 0; margin: 0 auto; display: flex; justify-content: center; gap: 40px; z-index: 2; width: fit-content; }
.img-btn { width: 210px; }

/* 1.5 關卡 */
.level-popup { width: 659px; height: 507px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; justify-content: center; align-items: center; }
.level-bg { position: absolute; width: 100%; height: 100%; z-index: -1; }
.level-grid-container { width: 560px; height: 240px; margin-top: 80px; display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(2, 1fr); gap: 20px; }
.level-btn-wrap { position: relative; width: 92px; height: 92px; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: transform 0.1s; }
.level-btn-wrap:active { transform: scale(0.9); }
.level-btn-bg { position: absolute; width: 100%; height: 100%; }
.level-num { position: relative; z-index: 2; color: #FFF; font-size: 40px; font-weight: 900; font-family: 'Arial Black', sans-serif; text-shadow: 0 2px 3px rgba(0,0,0,0); }
.level-btn-wrap.locked { cursor: not-allowed; opacity: 0.8; }
.level-btn-wrap.locked .level-num { display: none; }

/* 2. 遊戲 UI (★ 改用絕對定位佈局 ★) */
.game-layout-inner { 
    position: relative; width: 100%; height: 100%; 
    z-index: 5; display: block; /* 移除 flex */
}

/* 左側棋盤 (定位到 X:180) */
.playfield-area { 
    position: absolute; left: 180px; top: 0;
    width: 663px; height: 640px; 
    /* margin-left: 10px; 不需要了 */
}
.playfield-bg { 
    width: 100%; height: 100%; 
    background: url('images/04_game/playfield.png') no-repeat center; 
    background-size: 100% 100%; 
    position: relative; 
}
.grid-container { 
    position: absolute; top: 91px; left: 122px; 
    display: grid; grid-template-columns: repeat(4, 116px); grid-template-rows: repeat(4, 116px); gap: 8px; 
    z-index: 5; 
}
#fx-layer { position: absolute; top: 91px; left: 122px; width: 488px; height: 488px; z-index: 10; pointer-events: none; }

.tile { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
.tile-inner { width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center; animation: pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
.tile-inner.merged-anim { animation: mergePulse 0.3s ease-out forwards; }
@keyframes mergePulse { 0% { transform: scale(0.8); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

.skill-overlay { position: absolute; width: 116px; height: 116px; background-size: contain; background-repeat: no-repeat; background-position: center; z-index: 20; animation: fadeInOut 0.8s forwards; }
.skill-overlay.ice { opacity: 0.8; animation: none; }
.ice-counter { position: absolute; bottom: 2px; right: 2px; color: #fff; font-weight: bold; font-size: 20px; text-shadow: 1px 1px 2px #000; }
@keyframes fadeInOut { 0% { opacity: 0; transform: scale(1.2); } 20% { opacity: 1; transform: scale(1); } 80% { opacity: 1; } 100% { opacity: 0; } }

/* 右側面板 (定位到 X:860，調整高度分配) */
.sidebar-area { 
    position: absolute; left: 860px; top: 0;
    width: 320px; height: 640px; 
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start; 
    padding-top: 0px; /* 減少頂部空白 */
}

/* 上帝 */
.god-wrapper { position: relative; z-index: 2; margin-bottom: 0; width: 100%; display: flex; justify-content: center; }
.god-container { 
    width: 300px; height: 230px; 
    display: flex; justify-content: center; align-items: flex-end; 
    margin-bottom: 0px; /* 貼更近 */
}
#god-character { width: 100%; height: 100%; object-fit: contain; object-position: bottom center; }
.god-dialog { position: absolute; top: 40px; left: 70%; background: #fff; padding: 8px 15px; border-radius: 15px; border: 0px solid #3e3e3e; font-weight: bold; color: #544d4d; white-space: nowrap; z-index: 20; opacity: 1; transition: opacity 0.5s; }
.god-dialog.hidden { opacity: 0; }

/* 分數板 */
.info-group { 
    display: flex; flex-direction: column; 
    gap: 3px; 
    z-index: 1; 
    margin-bottom: 0px; /* 減少與技能的距離 */
}
.stat-box { width: 305px; height: 108px; background-size: 100% 100%; display: flex; justify-content: center; align-items: center; padding: 0; box-sizing: border-box; position: relative; }
.stat-box span { font-size: 50px; color: #fff; font-weight: 900; font-family: monospace; margin-top: -23px; }
.score-effect { position: absolute; top: -20px; right: 10px; color: #ff5252; font-weight: bold; font-size: 24px; opacity: 0; z-index: 10; }

/* 技能按鈕區 */
.skills-wrapper { width: 100%; margin-left: 0; display: flex; flex-direction: column; align-items: center; }
#skill-instruction { color: #3ea5bf; font-weight: bold; font-size: 14px; margin-bottom: 5px; background-color: rgba(255,255,255,0.8); padding: 2px 10px; border-radius: 6px; animation: blink 1s infinite; }

.bottom-skills-grid { 
    display: grid; 
    grid-template-columns: repeat(3, 90px); 
    grid-template-rows: repeat(2, 90px); 
    gap: 0px; 
}
.skill-btn { width: 100%; height: 100%; background: none; border: none; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
.skill-btn img { width: 85%; height: 85%; object-fit: contain; }
.skill-cost { position: absolute; bottom: 10px; right: 12px; font-size: 15px; color: #fff; font-weight: 900; pointer-events: none; }
.skill-cost.red-cost { color: #3369e7; }

/* 3. 成就 & 4. 圖鑑 */
.modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: transparent; z-index: 2000; display: flex; justify-content: center; align-items: center; }
.modal-overlay.hidden { display: none; }
.overlay-dimmer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: -1; }
.popup-container { position: relative; display: flex; justify-content: center; align-items: center; }
.popup-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
.close-btn { position: absolute; top: 15px; right: 15px; width: 50px; height: 50px; }
.achievement-list { width: 600px; height: 430px; margin-top: 85px; margin-left: auto; margin-right: auto; overflow-y: auto; padding-right: 10px; }
.achievement-list::-webkit-scrollbar { width: 10px; }
.achievement-list::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); border-radius: 5px; }
.achievement-list::-webkit-scrollbar-thumb { background: #4FC3F7; border-radius: 5px; border: none; }
.ach-item { width: 566px; height: 92px; margin: 0 auto 10px auto; position: relative; background-image: url('images/02_achievement/ach_bg.png'); background-size: 100% 100%; display: grid; grid-template-columns: 90px 150px 200px 1fr; align-items: center; }
.ach-col-icon { display: flex; justify-content: center; padding-left: 10px; }
.ach-col-icon img { width: 70px; height: 70px; object-fit: contain; }
.ach-col-title { font-size: 24px; font-weight: 900; color: #fff; padding-left: 20px; text-align: left; text-shadow: 0 0 2px rgba(0,0,0,0.5); }
.ach-col-desc { font-size: 14px; line-height: 1.4; color: #eceff1; text-align: left; padding-left: 80px; }
.ach-col-status { height: 100%; display: flex; justify-content: center; align-items: center; padding-right: 10px; }
.ach-col-status img { width: auto; height: 60%; object-fit: contain; }
.book-container { width: 890px; height: 570px; position: relative; display: flex; justify-content: center; align-items: center; }
.book-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
.page-left { position: absolute; top: 30px; left: 40px; width: 350px; height: 470px; }
.page-right { position: absolute; top: 30px; left: 440px; width: 350px; height: 470px; }
.book-grid-layout { display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 6px; height: 100%; align-content: start; }
.book-item { width: 100%; height: 100%; aspect-ratio: 97 / 128; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
.title-card img { width: 100%; height: auto; filter: contrast(1.2); }
.item-frame { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
.item-creature { position: relative; z-index: 1; width: 85%; height: 65%; object-fit: contain; margin-top: 8px; transition: transform 0.4s; }
.book-item:hover .item-creature { transform: translateY(-4px) scale(1); }
.item-info { position: absolute; z-index: 1; bottom: 1px; width: 100%; text-align: center; display: flex; justify-content: center; align-items: baseline; gap: 10px; }
.num-text { color: #bd8867; font-size: 30px; font-weight: 900; opacity: 0.5; font-family: 'Arial Black', sans-serif; }
.name-text { color: #795a50; font-size: 20px; font-weight: 900; letter-spacing: 1px; }
.book-item.locked .item-creature, .book-item.locked .item-info { display: none; }
.target-content-centered { position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%); width: 100%; text-align: center; }
.target-icon-box { width: 140px; height: 140px; margin: 0 auto; display: flex; justify-content: center; align-items: center; }
.target-icon-box img { width: 100%; height: 100%; object-fit: contain; animation: pop 1s infinite alternate; }
.modal-content-small { width: 425px; height: 420px; position: relative; display: flex; justify-content: center; align-items: center; }
.modal-bg-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center; z-index: 0; }
.modal-btn-group { position: absolute; bottom: 45px; left: 0; width: 100%; display: flex; justify-content: center; gap: 25px; z-index: 10; }
.popup-btn { width: 94px; height: 94px; background: none; border: none; padding: 0; }
.complete-creature-box { position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); width: 150px; height: 150px; z-index: 5; }
.complete-creature-box img { width: 100%; height: 90%; object-fit: contain; animation: bounceFast 0.2s infinite alternate; }
.fail-window { width: 425px; height: 391px; }
.fail-anim-bg { position: absolute; top: -50px; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; display: flex; justify-content: center; align-items: center; }
.alien-fail-anim { width: 300px; opacity: 0.8; }
#confetti-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; overflow: hidden; }
.confetti { position: absolute; width: 16px; height: 12px; animation: fall linear infinite; }
@keyframes fall { to { transform: translateY(640px) rotate(360deg); } }
@keyframes bounceFast { 0% { transform: translateY(0); } 100% { transform: translateY(-10px); } }
@keyframes pop { 0% {transform: scale(0.95);} 100% {transform: scale(1.05);} }
@keyframes float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-8px);} }
@keyframes blink { 50% { opacity: 0.5; } }